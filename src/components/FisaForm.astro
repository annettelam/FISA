---
const { schoolData = {}, isAdmin = false } = Astro.props;
---

<!-- FISA Form -->
<div
    class="max-w-3xl mx-auto mt-10 p-8 bg-white shadow-md rounded-lg"
    data-is-admin={isAdmin}
>
    <!-- Display error message if any -->
    {
        Object.keys(schoolData).length === 0 && (
            <div style="color: red;">
                <p>Error: No data available for the provided school ID.</p>
            </div>
        )
    }

    <form id="fees-form" class="space-y-6">
        <!-- School Information -->
        <div class="grid grid-cols-2 gap-4">
            <div>
                <label
                    for="schoolName"
                    class="block text-sm font-medium text-gray-900"
                    >School Name:</label
                >
                <input
                    type="text"
                    id="schoolName"
                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-3"
                    readonly
                    value={schoolData.schoolName || ""}
                />
            </div>
            <div>
                <label
                    for="schoolId"
                    class="block text-sm font-medium text-gray-900"
                    >School ID:</label
                >
                <input
                    type="text"
                    id="schoolId"
                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-3"
                    readonly
                    value={schoolData.schoolId || ""}
                />
            </div>
        </div>

        <!-- Enrollment Section -->
        <h2 class="text-xl font-bold text-gray-800 mb-4">
            Enrollment Information
        </h2>
        <div class="space-y-4">
            <div>
                <label
                    for="fullDayKindergarten"
                    class="block text-sm font-medium text-gray-900"
                >
                    A. Enrolment in Full-day Kindergarten:
                </label>
                <input
                    type="number"
                    id="fullDayKindergarten"
                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-3"
                    value={schoolData.fullDayKindergarten || 0}
                    readonly
                />
            </div>
            <div>
                <label
                    for="grades1To12"
                    class="block text-sm font-medium text-gray-900"
                    >B. Enrolment in Grades 1-12:</label
                >
                <input
                    type="number"
                    id="grades1To12"
                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-3"
                    value={schoolData.grades1To12 || 0}
                    readonly
                />
            </div>
            <div>
                <label
                    for="halfDayKindergarten"
                    class="block text-sm font-medium text-gray-900"
                >
                    C. Enrolment in Half-day Kindergarten:
                </label>
                <input
                    type="number"
                    id="halfDayKindergarten"
                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-3"
                    value={schoolData.halfDayKindergarten || 0}
                    readonly
                />
            </div>
            <div>
                <label
                    for="totalFTE"
                    class="block text-sm font-medium text-gray-900"
                    >D. Total F.T.E. Enrolment:</label
                >
                <input
                    type="text"
                    id="totalFTE"
                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-3"
                    readonly
                    value={(schoolData.totalFTE || 0).toFixed(2)}
                />
            </div>
            <div>
                <label
                    for="membershipFees"
                    class="block text-sm font-medium text-gray-900"
                    >E. Fee ($7.00 per F.T.E.):</label
                >
                <input
                    type="text"
                    id="membershipFees"
                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-3"
                    readonly
                    value={(schoolData.membershipFees || 0).toFixed(2)}
                />
            </div>
        </div>

        <!-- Contact Info Section -->
        <h2 class="text-xl font-bold text-gray-800 mb-4">
            Contact Information
        </h2>
        <div class="grid grid-cols-2 gap-4">
            <div>
                <label
                    for="contactName"
                    class="block text-sm font-medium text-gray-900">Name:</label
                >
                <input
                    type="text"
                    id="contactName"
                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-3"
                    disabled={!isAdmin}
                />
            </div>
            <div>
                <label
                    for="contactEmail"
                    class="block text-sm font-medium text-gray-900"
                    >Email:</label
                >
                <input
                    type="email"
                    id="contactEmail"
                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-3"
                    disabled={!isAdmin}
                />
            </div>
        </div>

        <!-- Submit Button -->
        <button
            type="submit"
            class="w-full text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:outline-none font-medium rounded-lg text-sm px-5 py-3 mt-4 text-center"
        >
            Submit
        </button>
    </form>
</div>

<!-- Include Client-Side Script for Calculations -->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const isAdmin =
            document.querySelector("[data-is-admin]").dataset.isAdmin ===
            "true";

        function calculateTotals() {
            const fullDayK =
                parseFloat(
                    document.getElementById("fullDayKindergarten").value,
                ) || 0;
            const grades1To12 =
                parseFloat(document.getElementById("grades1To12").value) || 0;
            const halfDayK =
                parseFloat(
                    document.getElementById("halfDayKindergarten").value,
                ) || 0;

            const totalFTE = fullDayK + grades1To12 + halfDayK / 2;
            const membershipFees = totalFTE * 7;

            document.getElementById("totalFTE").value = totalFTE.toFixed(2);
            document.getElementById("membershipFees").value =
                membershipFees.toFixed(2);
        }

        // If isAdmin is true, attach event listeners to the enrollment fields
        if (isAdmin) {
            document
                .getElementById("fullDayKindergarten")
                .addEventListener("input", calculateTotals);
            document
                .getElementById("grades1To12")
                .addEventListener("input", calculateTotals);
            document
                .getElementById("halfDayKindergarten")
                .addEventListener("input", calculateTotals);
        }
    });
</script>
