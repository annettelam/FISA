---
import Layout from '../layouts/Layout.astro';
import { authMiddleware } from '../middleware/auth.js';

// Invoke the middleware with the current request, require authentication and admin privileges
const { authenticated, user, redirectTo } = await authMiddleware(Astro.request, { requireAuth: true, requireAdmin: true });

if (!authenticated) {
  return Astro.redirect(redirectTo);
}
---
<Layout title="Admin Dashboard">
  <h1 class="text-3xl font-bold mb-4">Admin Dashboard</h1>
  <p>Welcome, {user.email}! You have administrative access.</p>
  <a href="/api/auth/signout" class="text-blue-600 hover:underline">Logout</a>
</Layout>
